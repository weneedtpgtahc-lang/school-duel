<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Virus vs Vaccine Duel</title>
<style>
body{font-family:system-ui,sans-serif;max-width:720px;margin:24px auto;padding:0 12px}
.card{border:1px solid #ddd;border-radius:12px;padding:12px;margin:12px 0}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
button,input{padding:10px 12px;font-size:16px}
pre{background:#f4f4f4;padding:12px;border-radius:10px;overflow:auto}
</style>
</head>
<body>

<h1>Virus vs Vaccine Duel</h1>

<div class="card">
  <div class="row">
    <button id="create">ë°© ë§Œë“¤ê¸°</button>
    <input id="code" placeholder="ë°© ì½”ë“œ ì…ë ¥" />
    <button id="join">ë°© ì°¸ê°€</button>
  </div>
  <p id="info">ëŒ€ê¸°ì¤‘â€¦</p>
</div>

<div class="card">
  <div class="row">
    <button id="virus">ë°”ì´ëŸ¬ìŠ¤ ì„ íƒ</button>
    <button id="vaccine">ë°±ì‹  ì„ íƒ</button>
  </div>
</div>

<pre id="state"></pre>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”´ ì—¬ê¸° firebaseConfigë¥¼ ë„¤ ê²ƒë¡œ êµì²´ */
const firebaseConfig = {
  apiKey: "AIzaSyBIZll4u_E6zHKyoJZqjCI6_P9cxhK1Shs",
  authDomain: "yanngok-9323a.firebaseapp.com",
  projectId: "yanngok-9323a",
  storageBucket: "yanngok-9323a.firebasestorage.app",
  messagingSenderId: "433037582784",
  appId: "1:433037582784:web:43d77ca2530126240a2825",
  measurementId: "G-M51E2S8PQF"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const me = crypto.randomUUID();
let room = null;

const $ = id => document.getElementById(id);

function listen() {
  onSnapshot(doc(db,"rooms",room), snap=>{
    $("state").textContent = JSON.stringify(snap.data(),null,2);
  });
}

$("create").onclick = async ()=>{
  room = Math.random().toString(36).slice(2,8).toUpperCase();
  await setDoc(doc(db,"rooms",room),{
    turn:1,
    players:{}
  });
  $("info").textContent = "ë°©: "+room;
  listen();
};

$("join").onclick = ()=>{
  room = $("code").value.toUpperCase();
  $("info").textContent = "ë°©: "+room;
  listen();
};

$("virus").onclick = async ()=>{
  const ref = doc(db,"rooms",room);
  const d = (await getDoc(ref)).data();
  d.players[me]={faction:"virus",hp:100};
  await setDoc(ref,d);
};

$("vaccine").onclick = async ()=>{
  const ref = doc(db,"rooms",room);
  const d = (await getDoc(ref)).data();
  d.players[me]={faction:"vaccine",hp:100};
  await setDoc(ref,d);
};
</script>
</body>
</html>
