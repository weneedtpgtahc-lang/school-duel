<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</title>
<style>
  body{font-family:system-ui,sans-serif;max-width:720px;margin:40px auto}
  button,input{padding:10px;font-size:16px}
  pre{background:#f6f6f6;padding:12px;border-radius:8px}
</style>
</head>
<body>

<h2>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</h2>

<button id="create">ë°© ë§Œë“¤ê¸°</button>
<input id="code" placeholder="ë°© ì½”ë“œ">
<button id="join">ë°© ì°¸ê°€</button>

<p id="info">ìƒíƒœ: ëŒ€ê¸°</p>
<pre id="state"></pre>

<script type="module">
/* ğŸ”¹ Firebase SDK */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* âœ… ë„¤ê°€ ì¤€ Firebase ì„¤ì • (ì •ìƒ) */
const firebaseConfig = {
  apiKey: "AIzaSyBIZll4u_E6zHKyoJZqjCI6_P9cxhK1Shs",
  authDomain: "yanngok-9323a.firebaseapp.com",
  projectId: "yanngok-9323a",
  storageBucket: "yanngok-9323a.firebasestorage.app",
  messagingSenderId: "433037582784",
  appId: "1:433037582784:web:43d77ca2530126240a2825",
  measurementId: "G-M51E2S8PQF"
};

/* ğŸ”¹ ì´ˆê¸°í™” */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ğŸ”¹ ìœ í‹¸ */
const $ = (id) => document.getElementById(id);
const rid = () => Math.random().toString(36).slice(2,8).toUpperCase();

let room = null;
let unsub = null;

/* ğŸ”¹ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ */
function listen() {
  if (!room) return;
  if (unsub) unsub();

  unsub = onSnapshot(doc(db,"rooms",room),(snap)=>{
    if (!snap.exists()) {
      $("state").textContent = "ë°© ì—†ìŒ";
      return;
    }
    $("state").textContent = JSON.stringify(snap.data(),null,2);
  });
}

/* ğŸ”¹ ë°© ë§Œë“¤ê¸° */
$("create").onclick = async () => {
  room = rid();
  await setDoc(doc(db,"rooms",room),{
    createdAt: serverTimestamp(),
    test: "Firebase ì—°ê²° ì„±ê³µ"
  });
  $("code").value = room;
  $("info").textContent = "ë°© ìƒì„±: " + room;
  listen();
};

/* ğŸ”¹ ë°© ì°¸ê°€ */
$("join").onclick = () => {
  room = $("code").value.trim().toUpperCase();
  $("info").textContent = "ë°© ì°¸ê°€: " + room;
  listen();
};
</script>

</body>
</html>
